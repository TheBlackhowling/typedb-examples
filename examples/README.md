# typedb Examples

This directory contains example programs demonstrating how to use typedb with different database systems. These examples show the **happy path** - successful operations that demonstrate typedb's features.

For comprehensive integration tests (including happy and negative paths), see the [`../integration_tests/`](../integration_tests/) directory.

## Quick Start with Docker

**ðŸš€ Fastest way to run all tests:**
```bash
cd examples
./run-tests.sh        # Linux/macOS
.\run-tests.ps1       # Windows PowerShell
```

This will:
1. Start all database containers (PostgreSQL, MySQL, SQL Server, Oracle*)
2. Wait for databases to be healthy
3. Run migrations automatically
4. Execute integration tests
5. Clean up containers

*Oracle requires one-time setup - run `./setup-oracle.sh` (or `.\setup-oracle.ps1` on Windows) first.

See [README-DOCKER.md](README-DOCKER.md) for detailed Docker setup instructions.

## Overview

Each database type has its own subdirectory with:
- **Example programs** (`example.go`) - Demonstrating typedb features (happy path only)
- **Migrations** - Database migration files (using golang-migrate format)
- **Schema files** - Legacy schema.sql files (for reference, migrations are preferred)
- **README** - Database-specific setup and usage instructions

## Supported Databases

- **[PostgreSQL](postgresql/)** - Full-featured with arrays and JSONB
- **[MySQL](mysql/)** - Popular open-source database
- **[SQLite](sqlite/)** - File-based, perfect for development
- **[SQL Server (MSSQL)](mssql/)** - Microsoft SQL Server
- **[Oracle](oracle/)** - Enterprise Oracle Database

## Quick Start

1. **Choose a database** from the list above
2. **Install golang-migrate:**
   ```bash
   # macOS
   brew install golang-migrate
   
   # Linux (or download from https://github.com/golang-migrate/migrate)
   curl -L https://github.com/golang-migrate/migrate/releases/download/v4.17.0/migrate.linux-amd64.tar.gz | tar xvz
   sudo mv migrate /usr/local/bin/migrate
   ```
3. **Navigate to the database directory:**
   ```bash
   cd examples/postgresql  # or mysql, sqlite, mssql, oracle
   ```
4. **Follow the README** in that directory for setup instructions
5. **Run migrations** to set up the database schema
6. **Run the example:**
   ```bash
   go run example.go models.go
   ```

**Note:** These examples demonstrate the happy path only. For comprehensive integration tests (including error cases), see the [`../integration_tests/`](../integration_tests/) directory.

## Common Patterns

All examples demonstrate the same core patterns:

### 1. Basic Queries
```go
// Query all records
users, err := typedb.QueryAll[*User](ctx, db, "SELECT * FROM users")

// Query first record
user, err := typedb.QueryFirst[*User](ctx, db, "SELECT * FROM users WHERE id = ?", 1)

// Query exactly one record (errors if 0 or 2+)
user, err := typedb.QueryOne[*User](ctx, db, "SELECT * FROM users WHERE id = ?", 1)
```

### 2. Model Loading
```go
// Load by primary key
user := &User{ID: 123}
err := typedb.Load(ctx, db, user)

// Load by unique field
user := &User{Email: "test@example.com"}
err := typedb.LoadByField(ctx, db, user, "Email")

// Load by composite key
userPost := &UserPost{UserID: 1, PostID: 2}
err := typedb.LoadByComposite(ctx, db, userPost, "userpost")
```

### 3. Transactions
```go
err := db.WithTx(ctx, func(tx *typedb.Tx) error {
    // All queries use the transaction
    users, err := typedb.QueryAll[*User](ctx, tx, "SELECT * FROM users")
    return err
}, nil)
```

## Database-Specific Notes

### Parameter Placeholders

Different databases use different parameter placeholder syntax:

- **PostgreSQL:** `$1`, `$2`, `$3`...
- **MySQL/SQLite:** `?`, `?`, `?`...
- **SQL Server:** `@p1`, `@p2`, `@p3`...
- **Oracle:** `:1`, `:2`, `:3`...

### JSON Handling

- **PostgreSQL:** Native JSONB type, arrays supported
- **MySQL:** Native JSON type (5.7+)
- **SQLite:** JSON stored as TEXT
- **SQL Server:** JSON stored as NVARCHAR(MAX) (2016+)
- **Oracle:** JSON stored as CLOB (12c+)

### Auto-Increment

- **PostgreSQL:** `SERIAL` or `GENERATED ALWAYS AS IDENTITY`
- **MySQL:** `AUTO_INCREMENT`
- **SQLite:** `INTEGER PRIMARY KEY AUTOINCREMENT`
- **SQL Server:** `IDENTITY(1,1)`
- **Oracle:** `GENERATED BY DEFAULT AS IDENTITY`

## Running All Examples

To run examples for all databases (requires all databases to be set up):

```bash
# From the examples directory
for dir in */; do
    echo "Running example in $dir"
    cd "$dir"
    go run example.go models.go
    cd ..
done
```

**Note:** Examples will fail if database connections fail. For comprehensive testing, use the integration tests in [`../integration_tests/`](../integration_tests/).

## CI/CD Integration

Examples are designed to:
- **Demonstrate happy path** usage of typedb features
- **Verify deployments** by running successfully against real databases
- **Fail fast** if database is unavailable (for deployment verification)

For comprehensive testing including error cases, use the integration tests in [`../integration_tests/`](../integration_tests/).

## Contributing

When adding examples for a new database:

1. Create a new subdirectory
2. Include:
   - `schema.sql` - Database schema
   - `models.go` - Model definitions
   - `example.go` - Example program (happy path only)
   - `migrations/` - Database migration files
   - `README.md` - Setup and usage instructions
3. Follow the patterns established in existing examples
4. Keep examples focused on demonstrating successful usage (happy path)
5. For comprehensive testing, add corresponding integration tests in [`../integration_tests/`](../integration_tests/)

## License

Examples are provided under the same license as typedb (MIT License).
